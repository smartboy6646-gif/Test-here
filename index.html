<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RPS Fixed Simulator</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: sans-serif; }
        
        /* Menu Style */
        #menu {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #222; padding: 20px; border: 2px solid #fff; border-radius: 10px;
            color: white; text-align: center; z-index: 100; width: 300px;
        }
        input { width: 50px; padding: 5px; text-align: center; font-size: 16px; margin: 5px; }
        button { 
            background: #0f0; border: none; padding: 10px 20px; font-size: 18px; 
            margin-top: 15px; cursor: pointer; border-radius: 5px; font-weight: bold;
        }

        /* Controls Style */
        #controls {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(255,255,255,0.1); padding: 10px 20px; border-radius: 20px;
            display: none; color: white; align-items: center; gap: 10px; width: 80%; max-width: 400px;
            z-index: 50;
        }
        input[type=range] { flex: 1; }
        
        #winner {
            position: absolute; top: 40%; width: 100%; text-align: center;
            font-size: 50px; color: white; display: none; text-shadow: 0 0 10px #000; z-index: 60;
        }
        #restart {
            position: absolute; top: 60%; left: 50%; transform: translateX(-50%);
            display: none; padding: 10px 20px; font-size: 20px; z-index: 60; cursor: pointer;
        }
    </style>
</head>
<body>

    <div id="menu">
        <h3>ğŸª¨ ğŸ“„ âœ‚ï¸ Setup</h3>
        <div>ğŸª¨ <input type="number" id="r" value="15"></div>
        <div>ğŸ“„ <input type="number" id="p" value="15"></div>
        <div>âœ‚ï¸ <input type="number" id="s" value="15"></div>
        <button onclick="startGame()">Start Game ğŸš€</button>
    </div>

    <div id="controls">
        <span>ğŸ¢ Slow</span>
        <input type="range" min="1" max="100" value="50" oninput="changeSpeed(this.value)">
        <span>Fast ğŸ‡</span>
    </div>

    <div id="winner"></div>
    <button id="restart" onclick="location.reload()">ğŸ”„ Restart</button>

    <script>
        let game;
        
        class GameScene extends Phaser.Scene {
            constructor() { super('GameScene'); }

            init(data) {
                this.counts = data;
                this.gameOver = false;
            }

            create() {
                // 1. Box Creation (White Border)
                let offset = 20; // Screen vanda ali vitra box banaune
                let w = this.scale.width - (offset * 2);
                let h = this.scale.height - (offset * 2);
                
                // Physics world ko boundary set garne (Box ko size)
                this.physics.world.setBounds(offset, offset, w, h);

                // Visual Border (Box dekhauna lai)
                let graphics = this.add.graphics();
                graphics.lineStyle(4, 0xffffff);
                graphics.strokeRect(offset, offset, w, h);

                // 2. Group Creation
                this.emojis = this.physics.add.group();

                // 3. Emojis Spawn garne Function
                const addEmoji = (type, count) => {
                    for(let i=0; i<count; i++) {
                        // Random Position (Box vitra matra)
                        let x = Phaser.Math.Between(offset + 20, w - 20);
                        let y = Phaser.Math.Between(offset + 20, h - 20);

                        let text = this.add.text(x, y, type, { fontSize: '32px' });
                        text.setOrigin(0.5);
                        
                        this.physics.add.existing(text);
                        
                        // Physics Properties
                        text.body.setCircle(15);
                        text.body.setCollideWorldBounds(true);
                        text.body.setBounce(1.1); // 1.1 le garda energy loss hudaina (move vairakhxa)
                        
                        // FIX: Ensure Velocity is never 0 (High Speed)
                        let vx = Phaser.Math.Between(200, 400) * (Math.random() > 0.5 ? 1 : -1);
                        let vy = Phaser.Math.Between(200, 400) * (Math.random() > 0.5 ? 1 : -1);
                        text.body.setVelocity(vx, vy);

                        text.typeData = type; // Type save garne
                        this.emojis.add(text);
                    }
                };

                addEmoji('ğŸª¨', this.counts.r);
                addEmoji('ğŸ“„', this.counts.p);
                addEmoji('âœ‚ï¸', this.counts.s);

                // 4. Collision Logic
                this.physics.add.collider(this.emojis, this.emojis, (a, b) => this.fight(a, b));
            }

            fight(a, b) {
                if(a.typeData === b.typeData) return;

                const map = { 'ğŸª¨': 'âœ‚ï¸', 'âœ‚ï¸': 'ğŸ“„', 'ğŸ“„': 'ğŸª¨' };

                if(map[a.typeData] === b.typeData) {
                    this.transform(b, a.typeData); // A wins
                } else {
                    this.transform(a, b.typeData); // B wins
                }
            }

            transform(loser, newType) {
                loser.setText(newType);
                loser.typeData = newType;
                
                // Pop Effect
                this.tweens.add({
                    targets: loser, scale: { from: 1.5, to: 1 }, duration: 150, yoyo: true
                });

                this.checkWin();
            }

            checkWin() {
                if(this.gameOver) return;
                
                let counts = { 'ğŸª¨': 0, 'ğŸ“„': 0, 'âœ‚ï¸': 0 };
                let total = 0;
                this.emojis.getChildren().forEach(e => { counts[e.typeData]++; total++; });

                if(counts['ğŸª¨'] == total || counts['ğŸ“„'] == total || counts['âœ‚ï¸'] == total) {
                    this.gameOver = true;
                    let winner = counts['ğŸª¨'] == total ? 'ğŸª¨' : (counts['ğŸ“„'] == total ? 'ğŸ“„' : 'âœ‚ï¸');
                    
                    document.getElementById('winner').innerHTML = `WINNER<br>${winner}`;
                    document.getElementById('winner').style.display = 'block';
                    document.getElementById('restart').style.display = 'block';
                    document.getElementById('controls').style.display = 'none';
                }
            }
        }

        function startGame() {
            let r = parseInt(document.getElementById('r').value);
            let p = parseInt(document.getElementById('p').value);
            let s = parseInt(document.getElementById('s').value);

            if(!r && !p && !s) return alert("Number halnu paryo!");

            document.getElementById('menu').style.display = 'none';
            document.getElementById('controls').style.display = 'flex';

            const config = {
                type: Phaser.AUTO,
                width: window.innerWidth,
                height: window.innerHeight,
                backgroundColor: '#111',
                physics: { default: 'arcade', arcade: { debug: false } },
                scene: [GameScene]
            };

            game = new Phaser.Game(config);
            game.scene.start('GameScene', { r, p, s });
        }

        // Speed Slider Logic
        function changeSpeed(val) {
            if(!game) return;
            // Val 0-100. 
            // 0 (Left) = Slow (TimeScale 2.0)
            // 50 (Mid) = Normal (TimeScale 1.0)
            // 100 (Right) = Fast (TimeScale 0.2)
            
            // Map 0-100 to 2.0-0.2
            let timeScale = 2.0 - (val / 100 * 1.8);
            game.scene.scenes[0].physics.world.timeScale = timeScale;
        }

    </script>
</body>
</html>
